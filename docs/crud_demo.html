<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Tenge CRUD Demo (C + SQLite)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Clean panel UI */
    :root { --bg:#0b1220; --card:#0e1730; --ink:#e8eefc; --muted:#99a9c9; --line:#23355b; --acc:#3c5fa1; }
    html,body { margin:0; background:var(--bg); color:var(--ink); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 16px; }
    header { padding: 24px 0 8px; border-bottom:1px solid var(--line); position: sticky; top:0; background: #0f1830; z-index:10; }
    h1 { margin: 0 0 6px; font-size: 28px; }
    p.lead { margin: 0 0 6px; color: var(--muted); }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .card { background:var(--card); border:1px solid var(--line); border-radius:12px; padding:12px; }
    input,button { font:inherit; }
    input[type=text], input[type=number] { background:#0a1330; color:var(--ink); border:1px solid var(--line); border-radius:8px; padding:8px 10px; }
    button { background:#13224a; color:#cfe0ff; border:1px solid #2a4585; border-radius:10px; padding:8px 12px; cursor:pointer; }
    button:hover { background:#1a2e61; }
    button[disabled] { opacity:.5; cursor:not-allowed; }
    .grid { display:grid; grid-template-columns: 1fr; gap: 12px; margin-top: 14px; }
    pre { margin:0; white-space:pre-wrap; word-break:break-word; }
    a { color:#9ec2ff; }
    .warn { color:#ffd699; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Tenge CRUD Demo</h1>
      <p class="lead">C + SQLite demo HTTP server (todos). Works locally; GitHub Pages over HTTPS cannot call HTTP localhost due to mixed content rules.</p>
      <div class="row" style="margin-top:8px">
        <div class="card">
          <label>Base URL:&nbsp;<input id="baseUrl" type="text" value="http://127.0.0.1:8080" size="32"></label>
        </div>
        <div class="card">
          <span id="envNote" class="warn"></span>
        </div>
        <div class="card">
          <a href="index.html">‚Üê Back to Benchmarks</a>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <div class="card">
        <h3>List</h3>
        <button id="btnList">GET /todos</button>
      </div>
      <div class="card">
        <h3>Add</h3>
        <div class="row">
          <input id="title" type="text" placeholder="title" value="Buy milk">
          <input id="priority" type="number" min="0" max="9" value="1" style="width:90px">
          <button id="btnAdd">POST /todos</button>
        </div>
      </div>
      <div class="card">
        <h3>Get / Done / Delete</h3>
        <div class="row">
          <input id="todoId" type="number" min="1" placeholder="id" style="width:110px">
          <button id="btnGet">GET /todos/:id</button>
          <button id="btnDone">PATCH /todos/:id {{done:true}}</button>
          <button id="btnDel">DELETE /todos/:id</button>
        </div>
      </div>
      <div class="card">
        <h3>Purge</h3>
        <button id="btnPurge">DELETE /purge (drop+recreate)</button>
      </div>
      <div class="card">
        <h3>Output</h3>
        <pre id="out">Ready.</pre>
      </div>
    </div>
  </main>

  <script>
    // All comments in English for documentation purposes only.
    const $ = (id) => document.getElementById(id);
    const out = $("out");
    const buttons = ["btnList","btnAdd","btnGet","btnDone","btnDel","btnPurge"].map($);

    function log(x) {
      out.textContent = typeof x === "string" ? x : JSON.stringify(x, null, 2);
    }
    function base() { return $("baseUrl").value.replace(/\/+$/, ""); }

    function setBlocked(reason) {
      buttons.forEach(b => b.disabled = true);
      $("envNote").textContent = reason;
    }

    // HTTPS page cannot call HTTP localhost (mixed content). Detect and warn.
    (function detectMixedContent() {
      const isHttps = location.protocol === "https:";
      const isGhPages = location.host.endsWith("github.io");
      if (isHttps && isGhPages) {
        setBlocked("Running on HTTPS (GitHub Pages). Browsers block fetch to HTTP localhost. Open this file locally or host over http://localhost to use buttons.");
      } else {
        $("envNote").textContent = "If your server is running, buttons should work.";
      }
    })();

    async function go(path, opts={}) {
      const url = base() + path;
      const res = await fetch(url, opts);
      const text = await res.text();
      try { return JSON.parse(text); } catch { return text; }
    }

    $("btnList").onclick = async () => {
      try { log(await go("/todos")); } catch (e) { log(String(e)); }
    };

    $("btnAdd").onclick = async () => {
      const title = $("title").value.trim();
      const pr = Number($("priority").value);
      try {
        const res = await go("/todos", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ title, priority: pr })
        });
        log(res);
      } catch(e) { log(String(e)); }
    };

    $("btnGet").onclick = async () => {
      const id = Number($("todoId").value);
      if (!id) return log("Provide id");
      try { log(await go(`/todos/${id}`)); } catch(e) { log(String(e)); }
    };

    $("btnDone").onclick = async () => {
      const id = Number($("todoId").value);
      if (!id) return log("Provide id");
      try {
        log(await go(`/todos/${id}`, {
          method:"PATCH",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ done: true })
        }));
      } catch(e) { log(String(e)); }
    };

    $("btnDel").onclick = async () => {
      const id = Number($("todoId").value);
      if (!id) return log("Provide id");
      try { log(await go(`/todos/${id}`, { method:"DELETE" })); } catch(e) { log(String(e)); }
    };

    $("btnPurge").onclick = async () => {
      try { log(await go(`/purge`, { method:"DELETE" })); } catch(e) { log(String(e)); }
    };
  </script>
</body>
</html>